# Helm Generator

The Helm Generator is used to generate manifests from a Helm chart, much like the [Kustomize chart example](https://github.com/kubernetes-sigs/kustomize/blob/master/examples/chart.md).

## Prerequisites

For this example, you will need Konjure, Kustomize, and Helm installed on your `PATH`. If you plan to use Konjure without Kustomize you can, however the Helm Generator requires the `helm` executable (you can specify an alternate location in your configuration if you like).

```bash
which konjure
which kustomize
which helm
konjure kustomize init HelmGenerator

DEMO_HOME=$(mktemp -d)
mkdir -p "$DEMO_HOME"
```

## Configuration

Create a configuration file for the Helm Generator, in this case we will generate manifests from the `stable/elasticsearch` chart, pinned to version 1.31.1.

```bash
cat <<'EOF' >"$DEMO_HOME/elasticsearch.yaml"
apiVersion: konjure.carbonrelay.com/v1beta1
kind: HelmGenerator
metadata:
  name: ignored

releaseName: elasticsearch
chart: stable/elasticsearch
version: 1.31.1
values:
  - name: data.replicas
    value: 3
EOF
```

## Kustomize

Create a kustomization the uses the Helm Generator configuration, for this example we are only including the resources generated by the Helm chart, however you can perform additional kustomizations on the resources if you like (though beware of using `commonLabels` on this example because this particular chart contains `apps/v1beta1` resources with implicit selectors!).

```bash
cat <<'EOF' >"$DEMO_HOME/kustomization.yaml"
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

generators:
  - elasticsearch.yaml
EOF
```

## Build

Finally, build the manifests. Notice that there are no test hook pods present in the output as they are filtered out by default.

```bash
kustomize build "$DEMO_HOME" --enable_alpha_plugins > "$DEMO_HOME/kustomized.yaml"
(! grep -q 'helm.sh/hook: test-success' "$DEMO_HOME/kustomized.yaml")
```

## Clean Up

Remove your demo workspace:

```bash
rm -rf "$DEMO_HOME"
```
# Jsonnet Generator

The Jsonnet Generator is used to run Jsonnet programs, this is useful when using projects that are built with Jsonnet.

## Prerequisites

For this example, you will need Konjure and Kustomize installed on your `PATH`. If you plan to use Konjure without Kustomize you can.

```sh
which konjure
which kustomize
konjure kustomize init JsonnetGenerator

DEMO_HOME=$(mktemp -d)
mkdir -p "$DEMO_HOME"
```

## Configuration

Create a configuration file for the Jsonnet Generator, in this case we will generate an example NGINX manifest from a simple Jsonnet program specified in the configuration file itself.

```sh
cat <<'EOF' >"$DEMO_HOME/nginx.yaml"
apiVersion: konjure.carbonrelay.com/v1beta1
kind: JsonnetGenerator
metadata:
  name: ignored

exec: |
  local podName = "nginx-demo";
  local container = {
    name: "nginx",
    image: "nginx:1.7.9",
    ports: [ { containerPort: 80 } ]
  };

  {
    apiVersion: "v1",
    kind: "Pod",
    metadata: {
      name: podName
    },
    spec: {
      containers: [ container ]
    }
  }
EOF
```

## Kustomize

Create a kustomization the uses the Jsonnet Generator configuration, for this example we are only including the resources generated by the Jsonnet program, however you can perform additional kustomizations on the resources if you like.

```sh
cat <<'EOF' >"$DEMO_HOME/kustomization.yaml"
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

generators:
  - nginx.yaml
EOF
```

## Build

Finally, build the manifests. Notice the output is already output as a YAML document stream.

```sh
kustomize build "$DEMO_HOME" --enable_alpha_plugins
```

## Clean Up

Remove your demo workspace:

```sh
rm -rf "$DEMO_HOME"
```
